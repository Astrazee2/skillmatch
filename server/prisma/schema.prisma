generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  sme
  specialist
  admin
}

enum VerificationStatus {
  pending
  verified
  rejected
}

enum ProjectStatus {
  open
  in_progress
  completed
  cancelled
}

enum ApplicationStatus {
  pending
  accepted
  rejected
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  userType  UserType @map("user_type")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  smeProfile       SMEProfile?
  specialistProfile SpecialistProfile?
  sentMessages     Message[]    @relation("SentMessages")
  receivedMessages Message[]    @relation("ReceivedMessages")
}

model SMEProfile {
  id             String   @id @default(cuid())
  userId         String   @unique @map("user_id")
  companyName    String   @map("company_name")
  industry       String
  companySize    String?  @map("company_size")
  phone          String?
  profileComplete Boolean @default(false) @map("profile_complete")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects Project[]
}

model SpecialistProfile {
  id                 String             @id @default(cuid())
  userId             String             @unique @map("user_id")
  fullName           String             @map("full_name")
  profilePhotoUrl    String?            @map("profile_photo_url")
  bio                String?            @db.Text
  hourlyRate         Float              @map("hourly_rate")
  experienceYears    Int                @map("experience_years")
  rating             Float              @default(0)
  verificationStatus VerificationStatus @default(pending) @map("verification_status")
  availabilityStatus Boolean            @default(true) @map("availability_status")
  expertiseAreas     String[]           @map("expertise_areas")
  skills             String[]
  portfolioLinks     Json?              @map("portfolio_links")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications Application[]
}

model Project {
  id            String        @id @default(cuid())
  smeId         String        @map("sme_id")
  title         String
  description   String        @db.Text
  category      String
  budgetMin     Float         @map("budget_min")
  budgetMax     Float         @map("budget_max")
  deadline      DateTime
  requiredSkills String[]     @map("required_skills")
  status        ProjectStatus @default(open)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  sme          SMEProfile     @relation(fields: [smeId], references: [id], onDelete: Cascade)
  applications Application[]
  messages     Message[]
}

model Application {
  id           String            @id @default(cuid())
  projectId    String            @map("project_id")
  specialistId String            @map("specialist_id")
  proposalText String            @map("proposal_text") @db.Text
  quotedPrice  Float?            @map("quoted_price")
  status       ApplicationStatus @default(pending)
  appliedAt    DateTime         @default(now()) @map("applied_at")

  project    Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  specialist SpecialistProfile @relation(fields: [specialistId], references: [id], onDelete: Cascade)
}

enum ContactStatus {
  new
  read
  responded
}

model ContactSubmission {
  id          String        @id @default(cuid())
  name        String
  email       String
  subject     String
  message     String        @db.Text
  submittedAt DateTime      @default(now()) @map("submitted_at")
  status      ContactStatus @default(new)

  @@map("contact_submissions")
}

model Message {
  id         String   @id @default(cuid())
  senderId   String   @map("sender_id")
  receiverId String   @map("receiver_id")
  projectId  String?  @map("project_id")
  messageText String  @map("message_text") @db.Text
  sentAt     DateTime @default(now()) @map("sent_at")
  read       Boolean  @default(false)

  sender   User    @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User    @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  project  Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
}
